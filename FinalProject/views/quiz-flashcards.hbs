{{!--
  ============================================================
  quiz_flashcards.hbs — Quiz-Flashcards M:M Page (CS340)
  Group 69 — Sasan Pourassef & Jeremy Dempsey
  Oregon State University

  Description:
    This file displays and manages the Quiz_Flashcards junction
    table with full CRUD operations:
      • READ: Display quiz-flashcard relationships
      • CREATE: Form to add flashcards to quizzes
      • UPDATE: Form to modify question order
      • DELETE: Button to remove flashcards from quizzes

  Purpose:
    Manages many-to-many relationships between Quizzes and
    Flashcards:
      1) Browse all quiz-flashcard associations
      2) Add flashcards to quizzes with question order
      3) Update the order of questions within quizzes
      4) Remove flashcards from quizzes
      5) Dynamic dropdowns for quiz and flashcard selection
    
    Sources:
        • This file was created based on standard Handlebars
          layout practices and customized for the Study Application.

  ============================================================
--}}

<h1>Quiz Flashcard Assignments</h1>

<p class="page-description">
    Manage which flashcards are included in each quiz. Build quizzes by assigning flashcards from study sets.
</p>

{{! READ - Display all quiz-flashcard assignments }}
<h2>Current Quiz Flashcard Assignments</h2>

{{#if assignments}}
<table>
    <thead>
        <tr>
            <th>Assignment ID</th>
            <th>Quiz</th>
            <th>Flashcard Question</th>
            <th>Study Set</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {{#each assignments}}
        <tr>
            <td>{{this.quiz_id}}-{{this.card_id}}</td>
            <td>{{this.quiz_id}}</td>
            <td>{{this.front_text}}</td>
            <td>{{this.studyset_title}}</td>
            <td>
                {{! DELETE form - will be functional in next step }}
                <form class="delete-form" method="POST" action="/quiz-flashcards/delete/{{this.quiz_id}}/{{this.card_id}}">
                    <input type="hidden" name="_method" value="DELETE">
                    <button type="submit" class="btn-delete">Remove from Quiz</button>
                </form>
            </td>
        </tr>
        {{/each}}
    </tbody>
</table>
{{else}}
<p class="no-data">No flashcards assigned to quizzes yet. Use the form below to add flashcards to a quiz.</p>
{{/if}}

{{! CREATE - Form to assign flashcard to quiz }}
<h2>Add Flashcard to Quiz</h2>

<form class="cuForm" id="assign-flashcard-form" method="POST" action="/add-quiz-flashcard">
    <label for="quiz_id">Select Quiz:</label>
    <select name="quiz_id" id="quiz_id" required>
        <option value="" disabled selected>Choose a quiz...</option>
        {{#each quizzes}}
        <option value="{{this.quiz_id}}">{{this.title}}</option>
        {{/each}}
    </select>

    <label for="card_id">Select Flashcard:</label>
    <select name="card_id" id="card_id" required>
        <option value="" disabled selected>Choose a flashcard...</option>
        {{#each flashcards}}
        <option value="{{this.card_id}}">
            {{this.front_text}} (from {{this.studyset_title}})
        </option>
        {{/each}}
    </select>

    <button type="submit" class="btn-submit">Add Flashcard to Quiz</button>
</form>

{{! Filter/View Options }}
<h2>View by Quiz</h2>

<form class="cuForm" id="filter-by-quiz-form" method="GET" action="/quiz-flashcards">
    <label for="filter_quiz_id">Filter by Quiz:</label>
    <select name="quiz_id" id="filter_quiz_id" onchange="this.form.submit()">
        <option value="">All Quizzes</option>
        {{#each quizzes}}
        <option value="{{this.quiz_id}}">{{this.title}}</option>
        {{/each}}
    </select>
</form>

<p class="info-note">
    <strong>Tip:</strong> Flashcards must belong to a study set before they can be added to a quiz. 
    Create flashcards in the Flashcards page first.
</p>

<h2>Update Question Order (UPDATE M:N) ⭐</h2>

<form class="cuForm" id="update-order-form" method="POST" action="/update-quiz-flashcard">
    <label for="update_quiz_id">Select Quiz-Flashcard:</label>
    <select name="quiz_id" id="update_quiz_id" required onchange="updateCardId()">
        <option value="" disabled selected>Choose a quiz-flashcard...</option>
        {{#each assignments}}
        <option value="{{this.quiz_id}}" data-card-id="{{this.card_id}}" data-order="{{this.question_order}}">
            Quiz #{{this.quiz_id}} - {{this.front_text}} (Current Order: {{this.question_order}})
        </option>
        {{/each}}
    </select>

    <input type="hidden" name="card_id" id="update_card_id" />

    <label for="update_question_order">New Question Order:</label>
    <input type="number" name="question_order" id="update_question_order" min="1" required placeholder="Enter new order number" />

    <button type="submit" class="btn-update">Update Order</button>
</form>

<script>
function updateCardId() {
    const select = document.getElementById('update_quiz_id');
    const selectedOption = select.options[select.selectedIndex];
    const cardId = selectedOption.getAttribute('data-card-id');
    document.getElementById('update_card_id').value = cardId;
}
</script>