{{!--
  ============================================================
  flashcards.hbs — Flashcards Entity Page (CS340)
  Group 69 — Sasan Pourassef & Jeremy Dempsey
  Oregon State University

  Description:
    This file displays and manages the Flashcards entity with
    full CRUD operations:
      • READ: Display all flashcards with study set info
      • CREATE: Form to add new flashcards to study sets
      • UPDATE: Form to modify flashcard content
      • DELETE: Button to remove flashcards

  Purpose:
    Allows users to:
      1) Browse all flashcards grouped by study set
      2) Create new flashcards with question/answer/difficulty
      3) Update flashcard content via dropdown selection
      4) Delete flashcards from study sets
      5) Select difficulty level from predefined options
    
    Sources:
        • This file was created based on standard Handlebars
          layout practices and customized for the Study Application.

  ============================================================
--}}

<div class="page-container">
    <h2>Flashcards Management</h2>
    <p class="page-description">Create and manage individual study questions and answers.</p>

    {{!-- Browse Flashcards Table --}}
    <div class="table-section">
        <h3>Existing Flashcards</h3>
        <table id="flashcards-table">
            <thead>
                <tr>
                    <th>Card ID</th>
                    <th>Study Set</th>
                    <th>Front Text</th>
                    <th>Back Text</th>
                    <th>Difficulty</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {{#each data}}
                <tr data-card-id="{{this.card_id}}">
                    <td>{{this.card_id}}</td>
                    <td>{{this.set_title}}</td>
                    <td>{{this.front_text}}</td>
                    <td>{{this.back_text}}</td>
                    <td>
                        <span class="difficulty-badge difficulty-{{this.difficulty_level}}">
                            {{this.difficulty_level}}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-small btn-edit" onclick="showUpdateForm({{this.card_id}})">Edit</button>
                        <button class="btn btn-small btn-delete" onclick="deleteFlashcard({{this.card_id}})">Delete</button>
                    </td>
                </tr>
                {{/each}}
                {{#unless data}}
                <tr>
                    <td colspan="6" style="text-align: center;">No flashcards found. Create one to get started!</td>
                </tr>
                {{/unless}}
            </tbody>
        </table>
    </div>

    {{!-- Add New Flashcard Form --}}
    <div class="form-section">
        <h3>Create New Flashcard</h3>
        <form id="add-flashcard-form" method="POST" action="/add-flashcard">
            <div class="form-group">
                <label for="set_id">Study Set:</label>
                <select id="set_id" name="set_id" required>
                    <option value="">-- Select Study Set --</option>
                    {{#each studysets}}
                    <option value="{{this.set_id}}">{{this.title}}</option>
                    {{/each}}
                </select>
                <small>Which study set does this flashcard belong to?</small>
            </div>

            <div class="form-group">
                <label for="front_text">Front (Question):</label>
                <textarea id="front_text" name="front_text" rows="3" required></textarea>
                <small>The question or prompt</small>
            </div>

            <div class="form-group">
                <label for="back_text">Back (Answer):</label>
                <textarea id="back_text" name="back_text" rows="3" required></textarea>
                <small>The answer or explanation</small>
            </div>

            <div class="form-group">
                <label for="difficulty_level">Difficulty Level:</label>
                <select id="difficulty_level" name="difficulty_level">
                    <option value="easy" selected>Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Create Flashcard</button>
        </form>
    </div>

    {{!-- Update Flashcard Form (Hidden by default) --}}
    <div id="update-flashcard-section" class="form-section" style="display: none;">
        <h3>Update Flashcard</h3>
        <form id="update-flashcard-form">
            <input type="hidden" id="update-card-id" name="card_id">
            
            <div class="form-group">
                <label for="update-set-id">Study Set:</label>
                <select id="update-set-id" name="set_id" required>
                    <option value="">-- Select Study Set --</option>
                    {{#each studysets}}
                    <option value="{{this.set_id}}">{{this.title}}</option>
                    {{/each}}
                </select>
            </div>

            <div class="form-group">
                <label for="update-front-text">Front (Question):</label>
                <textarea id="update-front-text" name="front_text" rows="3" required></textarea>
            </div>

            <div class="form-group">
                <label for="update-back-text">Back (Answer):</label>
                <textarea id="update-back-text" name="back_text" rows="3" required></textarea>
            </div>

            <div class="form-group">
                <label for="update-difficulty">Difficulty Level:</label>
                <select id="update-difficulty" name="difficulty_level">
                    <option value="easy">Easy</option>
                    <option value="medium">Medium</option>
                    <option value="hard">Hard</option>
                </select>
            </div>

            <button type="submit" class="btn btn-primary">Update Flashcard</button>
            <button type="button" class="btn btn-secondary" onclick="cancelUpdate()">Cancel</button>
        </form>
    </div>
</div>

<style>
/* Difficulty badge styling */
.difficulty-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 3px;
    font-size: 0.85rem;
    font-weight: 600;
    text-transform: uppercase;
}

.difficulty-easy {
    background-color: #d4edda;
    color: #155724;
}

.difficulty-medium {
    background-color: #fff3cd;
    color: #856404;
}

.difficulty-hard {
    background-color: #f8d7da;
    color: #721c24;
}
</style>

<script>
// Show update form with flashcard data
function showUpdateForm(cardId) {
    fetch('/flashcards/' + cardId)
        .then(response => response.json())
        .then(data => {
            document.getElementById('update-card-id').value = data.card_id;
            document.getElementById('update-set-id').value = data.set_id;
            document.getElementById('update-front-text').value = data.front_text;
            document.getElementById('update-back-text').value = data.back_text;
            document.getElementById('update-difficulty').value = data.difficulty_level;
            
            // Show the update form
            document.getElementById('update-flashcard-section').style.display = 'block';
            document.getElementById('update-flashcard-section').scrollIntoView({ behavior: 'smooth' });
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading flashcard data');
        });
}

// Cancel update
function cancelUpdate() {
    document.getElementById('update-flashcard-section').style.display = 'none';
    document.getElementById('update-flashcard-form').reset();
}

// Handle update form submission
document.getElementById('update-flashcard-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    let formData = {
        card_id: document.getElementById('update-card-id').value,
        set_id: document.getElementById('update-set-id').value,
        front_text: document.getElementById('update-front-text').value,
        back_text: document.getElementById('update-back-text').value,
        difficulty_level: document.getElementById('update-difficulty').value
    };
    
    fetch('/update-flashcard', {
        method: 'PUT',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(formData)
    })
    .then(response => {
        if (response.ok) {
            alert('Flashcard updated successfully!');
            location.reload();
        } else {
            alert('Error updating flashcard');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error updating flashcard');
    });
});

// Delete flashcard
function deleteFlashcard(cardId) {
    if (confirm('Are you sure you want to delete this flashcard?')) {
        fetch('/delete-flashcard/' + cardId, {
            method: 'DELETE'
        })
        .then(response => {
            if (response.ok) {
                alert('Flashcard deleted successfully!');
                document.querySelector(`tr[data-card-id="${cardId}"]`).remove();
            } else {
                alert('Error deleting flashcard');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting flashcard');
        });
    }
}
</script>
